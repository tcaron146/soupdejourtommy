(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[345],{5561:function(e,t,a){Promise.resolve().then(a.bind(a,8275))},4418:function(e,t,a){"use strict";a.d(t,{H:function(){return d},_:function(){return c}});var s=a(7437),r=a(2265),n=a(3105),l=a(3085),i=a(4086);let o=(0,r.createContext)(),d=e=>{let{children:t}=e,[a,d]=(0,r.useState)(null),c=async(e,t,a,s)=>{let r=await (0,l.Xb)(n.I,e,t);return await (0,l.ck)(r.user,{displayName:a}),await (0,i.pl)((0,i.JU)(n.db,"users",r.user.uid),{username:a,birthday:s,avatarUrl:"",bio:"",createdAt:Date.now()}),r.user},u=async()=>{let e=new l.hJ,t=await (0,l.rh)(n.I,e);await (0,i.pl)((0,i.JU)(n.db,"users",t.user.uid),{username:t.user.displayName,avatarUrl:t.user.photoURL,bio:"",birthday:""},{merge:!0})};return(0,r.useEffect)(()=>{let e=n.I.onAuthStateChanged(e=>{if(!e){d(null);return}let t=(0,i.JU)(n.db,"users",e.uid),a=(0,i.cf)(t,t=>{let a=t.data()||{};d({uid:e.uid,email:e.email,username:a.username||e.displayName||"User",avatarUrl:a.avatarUrl||"",bio:a.bio||"",birthday:a.birthday||""})});return()=>a()});return()=>e()},[]),(0,s.jsx)(o.Provider,{value:{user:a,emailSignIn:(e,t)=>(0,l.e5)(n.I,e,t),emailSignUp:c,googleSignIn:u,logOut:()=>(0,l.w7)(n.I)},children:t})},c=()=>(0,r.useContext)(o)},3105:function(e,t,a){"use strict";a.d(t,{I:function(){return o},db:function(){return d},t:function(){return c}});var s=a(994),r=a(3085),n=a(4086),l=a(9584);let i=(0,s.ZF)({apiKey:"AIzaSyAF8-fQl5ForsCDmsmcZJ7NIvfP0BxOIZE",authDomain:"soupdejourtommy-ba24e.firebaseapp.com",projectId:"soupdejourtommy-ba24e",storageBucket:"soupdejourtommy-ba24e.appspot.com",messagingSenderId:"880724282692",appId:"1:880724282692:web:71e1cc9f07dc8f90b21b11",measurementId:"G-YSN6SG0RZV"}),o=(0,r.v0)(i),d=(0,n.ad)(i),c=(0,l.cF)(i)},8275:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var s=a(7437),r=a(2265),n=a(4033),l=a(3105),i=a(4086),o=a(6691),d=a.n(o),c=a(4418),u=a(9584),m=a(1396),x=a.n(m);function h(e){let{postId:t}=e,{user:a}=(0,c._)()||{},[n,o]=(0,r.useState)([]),[d,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(!1);(0,r.useEffect)(()=>{let e=(0,i.IO)((0,i.hJ)(l.db,"posts",t,"comments"),(0,i.Xo)("createdAt","asc")),a=(0,i.cf)(e,e=>{o(e.docs.map(e=>({id:e.id,...e.data()})))});return()=>a()},[t]);let h=async()=>{if(!a)return alert("Login to comment");d.trim()&&(await (0,i.ET)((0,i.hJ)(l.db,"posts",t,"comments"),{text:d.trim(),parentId:null,userId:a.uid,username:a.username,avatarUrl:a.avatarUrl,createdAt:(0,i.Bt)()}),u(""))};return(0,s.jsxs)("div",{className:"mt-6",children:[(0,s.jsxs)("button",{onClick:()=>x(!m),className:"text-sm flex items-center gap-1 text-neutral-300 hover:text-white",children:["\uD83D\uDCAC Comments (",n.length,")"]}),m?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"mt-4",children:[(0,s.jsx)("textarea",{className:"w-full bg-neutral-800 p-3 rounded text-sm resize-none mb-2",rows:3,placeholder:"Add a comment…",value:d,onChange:e=>u(e.target.value)}),(0,s.jsx)("button",{onClick:h,className:"px-3 py-1 bg-secondary text-primary rounded text-sm hover:opacity-80",children:"Comment"})]}),(0,s.jsx)(p,{comments:n,parentId:null,postId:t})]}):null]})}function p(e){let{comments:t,parentId:a,postId:r}=e,n=t.filter(e=>e.parentId===a);return(0,s.jsx)("div",{className:"ml-10 mt-3 border-l border-neutral-800 pl-4",children:n.map(e=>(0,s.jsx)(f,{comment:e,comments:t,postId:r},e.id))})}function f(e){let{comment:t,comments:a,postId:n}=e,{user:o}=(0,c._)()||{},[d,u]=(0,r.useState)(!1),[m,x]=(0,r.useState)(""),h=async()=>{m.trim()&&(await (0,i.ET)((0,i.hJ)(l.db,"posts",n,"comments"),{text:m.trim(),parentId:t.id,userId:o.uid,username:o.username,avatarUrl:o.avatarUrl,createdAt:(0,i.Bt)()}),x(""),u(!1))};return(0,s.jsxs)("div",{className:"mb-4",children:[(0,s.jsxs)("div",{className:"flex gap-3",children:[(0,s.jsx)("img",{src:t.avatarUrl,className:"w-7 h-7 rounded-full mt-1"}),(0,s.jsxs)("div",{className:"flex-1",children:[(0,s.jsxs)("p",{className:"text-sm leading-5",children:[(0,s.jsx)("span",{className:"font-semibold",children:t.username})," ",(0,s.jsx)("span",{className:"text-neutral-300",children:t.text})]}),(0,s.jsx)("span",{className:"text-xs text-neutral-500 hover:text-white cursor-pointer",onClick:()=>u(!d),children:"Reply"}),(0,s.jsx)(p,{comments:a,parentId:t.id,postId:n})]})]}),d&&(0,s.jsxs)("div",{className:"ml-10 mt-2",children:[(0,s.jsx)("input",{className:"w-full p-2 rounded bg-neutral-800 text-sm mb-1",placeholder:"Reply…",value:m,onChange:e=>x(e.target.value)}),(0,s.jsx)("button",{onClick:h,className:"text-xs px-3 py-1 bg-secondary rounded",children:"Post"})]})]})}function b(e){let{post:t}=e,{id:a,text:n="",username:o="Unknown",avatarUrl:m="",imageUrl:p="",createdAt:f=null,userId:b}=t,{user:v}=(0,c._)()||{},[j,g]=(0,r.useState)(!1),[N,w]=(0,r.useState)(!0),[y,I]=(0,r.useState)(!1),[C,S]=(0,r.useState)(n),[U,k]=(0,r.useState)(!1);(0,r.useEffect)(()=>{if(!v){w(!1);return}let e=(0,i.JU)(l.db,"users",v.uid,"favorites",a);(0,i.QT)(e).then(e=>{e.exists()&&g(!0),w(!1)})},[v,a]);let D=async()=>{if(N)return;if(!v)return alert("Login to save posts!");let e=(0,i.JU)(l.db,"users",v.uid,"favorites",a);j?(await (0,i.oe)(e),g(!1)):(await (0,i.pl)(e,{saved:!0,savedAt:Date.now()}),g(!0))},J=async()=>{if(v&&v.uid===b&&confirm("Delete this post?"))try{if(p){let e=decodeURIComponent(p).split("/o/")[1].split("?")[0],t=(0,u.iH)(l.t,e);await (0,u.oq)(t).catch(()=>{})}await (0,i.oe)((0,i.JU)(l.db,"posts",a))}catch(e){console.error("Delete error:",e),alert("Failed to delete post.")}},E=async()=>{v&&v.uid===b&&(await (0,i.r7)((0,i.JU)(l.db,"posts",a),{text:C.trim()}),I(!1))};return(0,s.jsxs)("article",{className:"mb-5 rounded-xl border border-neutral-800 bg-neutral-900/40 px-4 py-3",children:[(0,s.jsxs)("header",{className:"flex items-center gap-3 mb-2",children:[(0,s.jsx)("div",{className:"h-9 w-9 rounded-full overflow-hidden bg-neutral-700/40",children:(0,s.jsx)(d(),{src:m||"/default-avatar.png",alt:"avatar",width:36,height:36,className:"w-full h-full object-cover",unoptimized:!0})}),(0,s.jsxs)("div",{className:"flex flex-col",children:[(0,s.jsx)(x(),{href:"/profile/".concat(b),children:(0,s.jsx)("span",{className:"font-semibold text-sm hover:underline cursor-pointer",children:o})}),(0,s.jsx)("span",{className:"text-xs text-neutral-500",children:(()=>{if(!(null==f?void 0:f.toDate))return"";let e=new Date,t=f.toDate(),a=(e-t)/1e3;return a<60?"".concat(Math.floor(a),"s ago"):a<3600?"".concat(Math.floor(a/60),"m ago"):a<86400?"".concat(Math.floor(a/3600),"h ago"):a<604800?"".concat(Math.floor(a/86400),"d ago"):t.toLocaleDateString()})()})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsx)("p",{className:"text-sm sm:text-[0.95rem] leading-relaxed whitespace-pre-line",children:n}),p&&(0,s.jsx)("div",{className:"rounded-lg overflow-hidden border border-neutral-800 w-full max-w-md",children:(0,s.jsx)(d(),{src:p,alt:"post image",width:600,height:350,className:"w-full h-auto object-cover"})})]}),(0,s.jsxs)("div",{className:"mt-3 flex items-center gap-4 text-xs text-neutral-500",children:[(0,s.jsxs)("button",{onClick:D,disabled:N,className:"flex items-center gap-1 px-2 py-1 rounded-full bg-neutral-900 border border-neutral-700 hover:border-yellow-400 transition ".concat(j?"text-yellow-400":"hover:text-yellow-300"),children:[(0,s.jsx)("span",{children:j?"★":"☆"}),(0,s.jsx)("span",{children:j?"Saved":"Save"})]}),(0,s.jsxs)("button",{onClick:()=>k(e=>!e),className:"flex items-center gap-1 px-2 py-1 rounded-full bg-neutral-900 border border-neutral-700 hover:border-neutral-400 hover:text-white transition",children:["\uD83D\uDCAC",(0,s.jsx)("span",{children:U?"Hide comments":"Show comments"})]})]}),U&&(0,s.jsx)(h,{postId:a}),v&&v.uid===b&&(0,s.jsxs)("footer",{className:"flex gap-3 text-xs mt-3",children:[(0,s.jsx)("button",{onClick:()=>I(!0),className:"text-blue-400 hover:underline",children:"Edit"}),(0,s.jsx)("button",{onClick:J,className:"text-red-400 hover:underline",children:"Delete"})]}),y&&(0,s.jsx)("div",{className:"fixed inset-0 bg-black/50 flex justify-center items-center z-50",children:(0,s.jsxs)("div",{className:"bg-neutral-900 p-6 rounded-xl w-96",children:[(0,s.jsx)("h2",{className:"text-lg font-semibold mb-3",children:"Edit post"}),(0,s.jsx)("textarea",{className:"w-full bg-neutral-800 p-2 rounded text-sm",rows:4,value:C,onChange:e=>S(e.target.value)}),(0,s.jsxs)("div",{className:"flex justify-between mt-4",children:[(0,s.jsx)("button",{className:"px-4 py-1 bg-neutral-700 rounded text-sm",onClick:()=>I(!1),children:"Cancel"}),(0,s.jsx)("button",{className:"px-4 py-1 bg-primary text-background rounded text-sm",onClick:E,children:"Save"})]})]})})]})}function v(){let e=(0,n.useParams)(),t=null==e?void 0:e.userId,[a,o]=(0,r.useState)(null),[d,c]=(0,r.useState)([]);return((0,r.useEffect)(()=>{t&&(0,i.QT)((0,i.JU)(l.db,"users",t)).then(e=>{e.exists()&&o(e.data())})},[t]),(0,r.useEffect)(()=>{if(!t)return;let e=(0,i.hJ)(l.db,"users",t,"favorites");(0,i.PL)(e).then(async e=>{let t=e.docs.map(e=>e.id);if(0===t.length)return c([]);c((await Promise.all(t.map(async e=>{let t=await (0,i.QT)((0,i.JU)(l.db,"posts",e));return t.exists()?{id:e,...t.data()}:null}))).filter(Boolean))})},[t]),a)?(0,s.jsxs)("main",{className:"max-w-2xl mx-auto pt-28 px-4 text-white",children:[(0,s.jsxs)("div",{className:"flex items-center gap-4 mb-8",children:[(0,s.jsx)("img",{src:a.avatarUrl,className:"w-20 h-20 rounded-full border border-neutral-700/30",alt:"avatar"}),(0,s.jsx)("h1",{className:"text-2xl font-semibold",children:a.username})]}),(0,s.jsx)("h2",{className:"text-xl font-semibold mb-3",children:"Saved Posts"}),0===d.length?(0,s.jsx)("p",{className:"text-neutral-500",children:"No saved posts."}):d.map(e=>(0,s.jsx)(b,{post:e},e.id))]}):(0,s.jsx)("p",{className:"pt-32 text-center text-white",children:"Loading profile…"})}},4033:function(e,t,a){e.exports=a(5313)}},function(e){e.O(0,[358,220,271,250,360,971,938,744],function(){return e(e.s=5561)}),_N_E=e.O()}]);